<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DLS 26 Admin Panel</title>
    <style>
        body { background: #0a0a0a; color: #fff; font-family: sans-serif; padding: 20px; }
        #login { text-align: center; }
        #admin-content { display: none; }
        form { margin: 20px 0; }
        select, input { margin: 10px; padding: 5px; }
        button { padding: 10px 20px; background: #00ffff; color: #000; border: none; cursor: pointer; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <div id="login">
        <h1>DLS 26 Admin Login</h1>
        <input type="password" id="password" placeholder="Enter Password">
        <button onclick="login()">Login</button>
    </div>

    <div id="admin-content">
        <h1>Admin Panel</h1>
        <h2>Update Match Result</h2>
        <form id="result-form">
            <select id="fixture-select"></select>
            <input type="number" id="home-goals" placeholder="Home Goals" min="0">
            <input type="number" id="away-goals" placeholder="Away Goals" min="0">
            <button type="button" onclick="updateResult()">Update</button>
        </form>
        <div id="message"></div>
    </div>

    <script>
        const GITHUB_REPO = 'yourusername/dls26-premier-league'; // Replace with your repo name
        const GITHUB_PAT = 'YOUR_GITHUB_PAT_HERE'; // Replace with your PAT
        let data;

        async function loadData() {
            const response = await fetch('data.json');
            data = await response.json();
            return data;
        }

        function login() {
            const inputPass = document.getElementById('password').value;
            if (inputPass === data.password) {
                document.getElementById('login').style.display = 'none';
                document.getElementById('admin-content').style.display = 'block';
                populateFixtures();
            } else {
                alert('Incorrect Password');
            }
        }

        function populateFixtures() {
            const select = document.getElementById('fixture-select');
            data.fixtures.forEach((fixture, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.text = `${fixture.home} vs ${fixture.away}`;
                select.appendChild(option);
            });
        }

        async function updateResult() {
            const index = document.getElementById('fixture-select').value;
            const hgoals = parseInt(document.getElementById('home-goals').value);
            const agoals = parseInt(document.getElementById('away-goals').value);

            if (isNaN(hgoals) || isNaN(agoals)) {
                showMessage('Enter valid goals', 'error');
                return;
            }

            const fixture = data.fixtures[index];
            if (fixture.hgoals !== null) {
                showMessage('Match already updated', 'error');
                return;
            }

            fixture.hgoals = hgoals;
            fixture.agoals = agoals;

            // Update team stats
            updateTeamStats(fixture.home, hgoals, agoals);
            updateTeamStats(fixture.away, agoals, hgoals);

            // Save to GitHub
            await saveDataToGitHub();
            showMessage('Result updated successfully!', 'success');
        }

        function updateTeamStats(teamName, goalsFor, goalsAgainst) {
            const team = data.teams.find(t => t.name === teamName);
            team.p += 1;
            team.gf += goalsFor;
            team.ga += goalsAgainst;
            team.gd = team.gf - team.ga;

            if (goalsFor > goalsAgainst) {
                team.w += 1;
                team.pts += 3;
            } else if (goalsFor === goalsAgainst) {
                team.d += 1;
                team.pts += 1;
            } else {
                team.l += 1;
            }
        }

        async function saveDataToGitHub() {
            const url = `https://api.github.com/repos/${GITHUB_REPO}/contents/data.json`;
            const response = await fetch(url, {
                headers: { 'Authorization': `token ${GITHUB_PAT}` }
            });
            const { sha } = await response.json();

            const updateResponse = await fetch(url, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${GITHUB_PAT}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: 'Update league data',
                    content: btoa(JSON.stringify(data, null, 2)),
                    sha: sha
                })
            });

            if (!updateResponse.ok) {
                throw new Error('Failed to update');
            }
        }

        function showMessage(msg, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.className = type;
            messageDiv.textContent = msg;
        }

        window.addEventListener('load', async () => {
            await loadData();
        });
    </script>
</body>
    </html>
